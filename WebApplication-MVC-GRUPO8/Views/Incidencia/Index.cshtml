@model IEnumerable<WebApplication_MVC_GRUPO8.Models.Incidencia>

@{
	ViewData["Title"] = "Incidencias";
}

<div class="container mt-4">
	<div class="row">
		<div class="col-md-12">

			@* Título y botón de crear *@
			<div class="d-flex justify-content-between align-items-center mb-4">
				<h1>
				   Incidencias
				</h1>
				<a asp-action="Create" class="btn btn-primary">
					<i class="bi bi-plus-circle"></i> Reportar Incidencia
				</a>
			</div>

			@* Mensaje de éxito (si existe) *@
			@if (TempData["Success"] != null)
			{
						<div class="alert alert-success alert-dismissible fade show" role="alert">
							<i class="bi bi-check-circle"></i> @TempData["Success"]
							<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
						</div>
			}

			@* Tabla de incidencias *@
			<div class="card shadow">
				<div class="card-body">
					<div class="table-responsive">
						<table class="table table-hover">
							<thead class="table-dark">
								<tr>
									<th>ID</th>
									<th>Título</th>
									<th>Estado</th>
									<th>Reportado por</th>
									<th>Fecha</th>
									<th>Prioridad</th>
									<th class="text-center">Acciones</th>
								</tr>
							</thead>
							<tbody>
								@foreach (var item in Model)
								{
								<tr>
									<td>
										<strong>#@item.id</strong>
									</td>
								<td>
									<div class="d-flex align-items-center">
										@if (!string.IsNullOrEmpty(item.imagenIncidencia))
										{
											<img src="@item.imagenIncidencia" 
												alt="Thumbnail" 
												 class="rounded me-2" 
												style="width: 50px; height: 50px; object-fit: cover;" />
										}
										<div>
											<strong>@item.titulo</strong>
												<br />
											<small class="text-muted">
											@(item.descripcion.Length > 50 ?
												item.descripcion.Substring(0, 50) + "..." :
												item.descripcion)
											</small>
										</div>
									</div>
								</td>
								<td>
								@switch (item.estadoIncidencia)
									{
									case EstadoIncidencia.reportado:
													<span class="badge rounded-pill bg-info text-dark">Reportado</span>
										break;
									case EstadoIncidencia.asignado:
													<span class="badge rounded-pill bg-warning">Asignado</span>
										break;
									case EstadoIncidencia.enReparacion:
													<span class="badge rounded-pill bg-primary">En Reparación</span>
										break;
									case EstadoIncidencia.descartado:
													<span class="badge rounded-pill bg-danger">Descartado</span>
										break;
										default:
													<span class="badge rounded-pill bg-light text-dark">@item.estadoIncidencia</span>
										break;
									}
								</td>
								
								<td>
									@if (item.Usuario != null)
										{
											<span>@item.Usuario.nombre @item.Usuario.apellido</span>
										}
										else
										{
											<span class="text-muted">Usuario desconocido</span>
										}
								</td>
								<td>
									@item.fechaReporte.ToString("dd/MM/yyyy HH:mm")
								</td>
										<td>
											@if (item.prioridad.HasValue)
											{
												switch (item.prioridad.Value)
												{
													case Prioridad.alta:
														<span class="badge bg-danger" style="width:50px">Alta</span>
														break;
													case Prioridad.media:
														<span class="badge bg-warning text-dark" style="width:50px">Media</span>
														break;
													case Prioridad.baja:
														<span class="badge bg-success" style="width:50px">Baja</span>
														break;
												}
											}
											else
											{
												<span class="text-muted">Sin asignar</span>
											}
										</td>
								<td class="text-center">
									<div class="btn-group" role="group">
										<a asp-action="Details" asp-route-id="@item.id" 
											class="btn btn-sm btn-info" 
											title="Ver Detalles">
											<i class="bi bi-eye"></i>
										</a>
										@* TODO: Agregar botones según el estado y rol del usuario *@
									</div>
								</td>
							</tr>
								}
							</tbody>
						</table>

						@if (!Model.Any())
						{
							<div class="alert alert-info text-center mt-3">
								<i class="bi bi-info-circle"></i> No hay incidencias registradas.
								<br />
							</div>
						}
					</div>
				</div>
			</div>
		</div>
	</div>
</div>